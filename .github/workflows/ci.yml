name: CI

on:
  push:
    branches:
      - main
    paths-ignore:
      - '**.md'
      - '.gitignore'
      - 'LICENSE'
  pull_request:
    branches:
      - main
    paths-ignore:
      - '**.md'
      - '.gitignore'
      - 'LICENSE'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - uses: cachix/install-nix-action@v27
      with:
        nix_path: nixpkgs=channel:nixos-unstable

    - name: Build with Nix
      run: nix build .

    # Go tests are inherently run during 'nix build' if doCheck is true (default).
    # However, flake.nix currently has doCheck = false.
    # We can run them explicitly here using the nix-shell environment or go directly if tools are available.
    # A cleaner integration is to use 'nix develop' to run tests.
    - name: Run Tests
      run: nix develop --command go test -v ./...
